(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c926dac6"],{"64e3":function(e,t,i){"use strict";i.r(t);var n,o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"nd-upload"},[t("confirm-dialog",{attrs:{id:"uploaderConfirmDialog",title:e.confirmCfg.title,visible:e.confirmCfg.show,showCancelBtn:e.confirmCfg.showCancelBtn,confirmText:e.confirmCfg.okText,cancelText:e.confirmCfg.cancelText},on:{"update:visible":function(t){return e.$set(e.confirmCfg,"show",t)},confirm:e.confirmCfg.okFn,cancel:e.cancel}},[t("div",{staticClass:"nd-dialog__delete-tip",attrs:{slot:"tip"},slot:"tip"},[t("p",{domProps:{innerHTML:e._s(e.confirmCfg.content)}})])])],1)},a=[],r=(i("14d9"),i("c73d"),function(){var e=this,t=e._self._c;return t("u-dialog",{staticClass:"nd-dialog-common-header",attrs:{title:e.title,width:e.width,modalAppendToBody:e.modalAppendToBody,appendToBody:e.appendToBody,center:e.center,closeOnClickModal:e.closeOnClickModal,lockScroll:!1,visible:e.innerVisible},on:{close:e.handleClose,"update:visible":function(t){e.innerVisible=t}}},[e.tip?t("p",{staticClass:"nd-dialog__delete-tip"},[e._v(e._s(e.tip))]):e._e(),e._t("tip"),e.noFooter?e._e():t("div",{staticClass:"nd-dialog-footer-center nd-dialog-common-footer",attrs:{slot:"footer"},slot:"footer"},[e.showCancelBtn?t("u-button",{staticClass:"nd-second-primary-btn nd-btn-fix-size-middle",attrs:{round:"",type:"week",size:"medium"},on:{click:e.cancel}},[e._v(" "+e._s(e.cancelText)+" ")]):e._e(),e._t("footer-btns"),t("u-button",{staticClass:"nd-btn-fix-size-middle",attrs:{type:"primary",round:"",size:"medium"},on:{click:e.confirm}},[e._v(e._s(e.confirmText))])],2)],2)}),s=[],l={props:{visible:{type:Boolean,default:!1},center:{type:Boolean,default:!1},title:{type:String,default:""},width:{type:String,default:"440px"},modalAppendToBody:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},tip:{type:String,default:""},cancelText:{type:String,default:"取 消"},confirmText:{type:String,default:"确 定"},showCancelBtn:{type:Boolean,default:!0},noFooter:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0}},computed:{innerVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{handleClose:function(){this.$emit("close")},cancel:function(){this.$emit("cancel"),this.$emit("update:visible",!1)},confirm:function(){this.$emit("confirm")}}},u=l,c=(i("fc52"),i("2877")),d=Object(c["a"])(u,r,s,!1,null,null,null),p=d.exports,f=i("0a4e"),h=i("53ca"),v=i("d4ec"),g=i("bee2"),m=(i("d9e2"),i("caad"),i("2532"),i("fa8e")),_=function(){function e(){Object(v["a"])(this,e),this.cache={},this.featureSupport={localStorageAccess:!0,localStorageCall:!0,indexedDBCall:!0},this.browserMode={IE67:!1},this._checkFeature()}return Object(g["a"])(e,[{key:"_checkFeature",value:function(){var e=this;if("undefined"==typeof document||"undefined"==typeof document.body)throw new Error("Storage Module Need Document Availability");try{window.localStorage}catch(t){e.featureSupport.localStorageAccess=!1}try{window.localStorage.setItem("localStorageCall","true")}catch(t){e.featureSupport.localStorageCall=!1}try{location.host.includes("www")?indexedDB.open("www."+m["h"],"v5"):indexedDB.open(m["h"],"v5")}catch(t){e.featureSupport.indexedDBCall=!1}"undefined"!=typeof window.attachEvent&&"object"!=Object(h["a"])(window.localStorage)&&(e.browserMode.IE67=!0)}},{key:"getUserData",value:function(){var e="_simulateLocalStorage",t=365,i=new Date;i.setDate(t+i.getDate());var n=document.createElement("input");n.type="hidden";try{n.addBehavior("#default#userData")}catch(o){return this.getOverwriteLocalStorage()}return document.body.appendChild(n),n.expires=i.toUTCString(),{setItem:function(t,i){n.load(e),n.setAttribute(t,i),n.save(e)},getItem:function(t){return n.load(e),n.getAttribute(t)},removeItem:function(t){n.load(e),n.removeAttribute(t),n.save(e)},clear:function(){n.load(e);var t=new Date;t.setDate(t.getDate()-1),n.expires=t.toUTCString(),n.save(e)}}}},{key:"getOverwriteLocalStorage",value:function(){var e=this;return window.localStorage=window.sessionStorage={setItem:function(t,i){e.cache[t]=i},getItem:function(t){return e.cache[t]||null},removeItem:function(t){delete e.cache[t]},clear:function(){e.cache={}},overwrite:!0,localStorageAccess:e.featureSupport.localStorageAccess,localStorageCall:e.featureSupport.localStorageCall,indexedDBCall:e.featureSupport.indexedDBCall}}},{key:"getStorage",value:function(){var e=this;return!e.featureSupport.localStorageAccess||e.browserMode.IE67?e.getUserData():e.featureSupport.localStorageCall?window.localStorage:e.getOverwriteLocalStorage()}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),y=_.getInstance().getStorage(),b=i("5530"),k=(i("b680"),i("ac1f"),i("00b4"),i("15fd")),S=(i("99af"),i("a15b"),i("e9c4"),i("cca6"),i("b64b"),i("d3b7"),i("25f0"),i("5319"),i("841c"),i("e7c1")),w=i.n(S),I=i("4328"),F=i("bc3a"),x=i.n(F),C=window,T=C.document,E=C.decodeURI,U=function(){function e(){Object(v["a"])(this,e)}return Object(g["a"])(e,[{key:"setCookie",value:function(e,t,i,n,o){var a=new Date,r="",s="";a.setDate(a.getDate()+i),o&&(r=";domain="+o),n&&(s=";path="+n),T.cookie=e+"="+escape(t)+(null==i?"":";expires="+a.toGMTString())+s+r}},{key:"getCookie",value:function(e){var t,i;return T.cookie.length>0&&(t=T.cookie.indexOf(e+"="),-1!=t)?(t=t+e.length+1,i=T.cookie.indexOf(";",t),-1==i&&(i=T.cookie.length),E(T.cookie.substring(t,i))):""}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),D=U.getInstance(),$=i("35d0"),A=i("4583"),L=["clearCache"],O=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(v["a"])(this,e),this.ctx=t,this.urlConf={locateUpload:"//".concat(Object(m["i"])(),"d.")+m["h"]+"/rest/2.0/pcs/file?method=locateupload",rapidUpload:"/api/rapidupload",preCreate:"/api/precreate",createFile:"/api/create?isdir=0"},this.conf={serverUrl:"",initBack:[],startInit:!1,endInit:!1,defaultServerHost:Object(m["i"])()+"c-all."+m["h"],serverHost:Object(m["i"])()+"c-all."+m["h"],serverTime:null,clientIp:null,timeoutLimit:1e4},this.uploadStorageKey=m["e"]}return Object(g["a"])(e,[{key:"_reLocateUpload",value:function(){var e=this.conf.serverUrlList;return null!=e&&null!=this.conf.serverUrlIndex&&this.conf.serverUrlIndex++<e.length-1&&(this.conf.serverHost=e[this.conf.serverUrlIndex],this._setServerUrl(),!0)}},{key:"_getLogId",value:function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/~！@#￥%……&",t=String.fromCharCode,i=function(e){var i="";return e.length<2?(i=e.charCodeAt(0),i<128?e:i<2048?t(192|i>>>6)+t(128|63&i):t(224|i>>>12&15)+t(128|i>>>6&63)+t(128|63&i)):(i=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320),t(240|i>>>18&7)+t(128|i>>>12&63)+t(128|i>>>6&63)+t(128|63&i))},n=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,o=function(e){return(e+""+Math.random()).replace(n,i)},a=function(t){var i=[0,2,1][t.length%3],n=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0),o=[e.charAt(n>>>18),e.charAt(n>>>12&63),i>=2?"=":e.charAt(n>>>6&63),i>=1?"=":e.charAt(63&n)];return o.join("")},r=function(e){return e.replace(/[\s\S]{1,3}/g,a)},s=function(e){return r(o((new Date).getTime()))},l=function(e,t){return t?s(String(e)).replace(/[+\/]/g,(function(e){return"+"===e?"-":"_"})).replace(/=/g,""):s(String(e))};return l(D.getCookie("BAIDUID"))}},{key:"_setServerUrl",value:function(){this.conf.serverUrl="//"+this.conf.serverHost+"/rest/2.0/pcs/superfile2?method=upload",y.getItem("uploadUrl")&&(this.conf.serverUrl=y.getItem("uploadUrl")),this.conf.serverUrl+="&app_id=250528&channel=dubox&clienttype=0&web=1&logid="+this._getLogId()}},{key:"_initFunc",value:function(){if(!this.conf.endInit){this._setServerUrl(),this.conf.endInit=!0;for(var e=0,t=this.conf.initBack.length;e<t;e++)"function"===typeof this.conf.initBack[e]&&this.conf.initBack[e]()}}},{key:"_formatTime",value:function(e,t){return e&&e.lastModified?t.local_mtime=parseInt(e.lastModified/1e3,10):e.creationdate&&e.modificationdate?(t.local_ctime=parseInt(Date.parse(e.creationdate)/1e3,10),t.local_mtime=parseInt(Date.parse(e.modificationdate)/1e3,10)):(e&&e.local_ctime&&(t.local_ctime=parseInt(e.local_ctime/1e3,10)),e&&e.local_mtime&&(t.local_mtime=parseInt(e.local_mtime/1e3,10))),t}},{key:"_getTargetPath",value:function(e){return e&&e.file&&e.file.server_path?e.file.server_path:""}},{key:"_encryptMd5",value:function(e){if(e&32!=e.length)return e;for(var t=0,i=e.length;t<i;t++)if(!(e[t]>=0&&e[t]<=9||e[t]>="a"&&e[t]<="f"))return e;for(var n=e.substr(8,8)+e.substr(0,8)+e.substr(24,8)+e.substr(16,8),o="",a=0,r=n.length;a<r;a++)o+=(parseInt(n[a],16)^15&a).toString(16);var s=String.fromCharCode("g".charCodeAt()+parseInt(o[9],16)),l=o.substr(0,9)+s+o.substr(10);return l}},{key:"_locateUpload",value:function(){var e=this;if(!window.ActiveXObject&&!("ActiveXObject"in window)){var t=Object(I["parse"])(location.search.substring(1)),i=t.clearCache,n=void 0===i?"0":i,o=Object(k["a"])(t,L);if("1"===n){y.removeItem(this.uploadStorageKey);var a=Object.keys(o).length?"?"+Object(I["stringify"])(Object(b["a"])({},o)):location.pathname;history.replaceState(null,null,a)}var r=y.getItem(this.uploadStorageKey);if(r)try{if(r=JSON.parse(r),+new Date-r.timestamp<6e5)return Object.assign(this.conf,{serverUrlIndex:0,clientIp:r.client_ip,serverHost:r.server[0],serverUrlList:r.server}),void this._initFunc();y.removeItem(this.uploadStorageKey)}catch(s){y.removeItem(this.uploadStorageKey)}try{x.a.get(this.urlConf.locateUpload,{withCredentials:!0,headers:{"Content-Type":"application/json;charset=UTF-8"}}).then((function(t){if(t&&200===t.status){var i=t.data||{},n=i.server,o=i.client_ip;null!=n&&(Object.assign(e.conf,{serverUrlIndex:0,clientIp:o,serverHost:n[0],serverUrlList:n}),e.conf.serverUrlList.push(e.conf.defaultServerHost),e._initFunc(),t.data&&(t.data.timestamp=+new Date),y.setItem(e.uploadStorageKey,JSON.stringify(t.data)))}}))}catch(s){console.log("get locateUpload error:",s)}}}},{key:"init",value:function(e){var t=this;this.conf.endInit?"function"===typeof e&&e():(this.conf.initBack.push(e),this.conf.startInit||(this.conf.startInit=!0,this._locateUpload(),setTimeout((function(){t._initFunc()}),2e3)))}},{key:"preCreate",value:function(e){var t=this,i=this,n=e.path,o=e.file,a=e.blockList&&"object"===Object(h["a"])(e.blockList)?JSON.stringify(e.blockList):"string"===typeof e.blockList?e.blockList:"[]",r={path:n,autoinit:1,uploadid:e.uploadid,uploadsign:e.uploadsign,target_path:this._getTargetPath(e),block_list:a,size:o.size,file_limit_switch_v34:!0};r=this._formatTime(o,r),Object($["b"])(this.urlConf.preCreate,{},r).then((function(i){e.callback(i,t.urlConf.preCreate)})).catch((function(n){var o,a,r,s=null===(o=window.globalVue)||void 0===o||null===(o=o.$store)||void 0===o||null===(o=o.state)||void 0===o?void 0:o.webmaster,l=s.webmasterIdentity,u=l?"webmaster":"normal";null===(a=window)||void 0===a||null===(a=a.globalVue)||void 0===a||a.$writeLog("action","web_uploadfile_normalUpload_fail",{errno:null!==(r=null===n||void 0===n?void 0:n.errno)&&void 0!==r?r:n,page:"main",apiType:"api_precreate_error",authentication:u}),e.callback(t._formatError(n),i.urlConf.preCreate)}))}},{key:"_formatError",value:function(e){var t,i;return{errno:null!==(t=null===e||void 0===e?void 0:e.errno)&&void 0!==t?t:-1,errmsg:null!==(i=null===e||void 0===e?void 0:e.message)&&void 0!==i?i:"Unknown error"}}},{key:"create",value:function(e,t){var i,n=e.blockList&&"object"===Object(h["a"])(e.blockList)?JSON.stringify(e.blockList):"string"===typeof e.blockList?e.blockList:"[]",o=!1;setTimeout((function(){o||e.callback&&e.callback({})}),this.conf.timeoutLimit);var a=this.urlConf.createFile;t&&(a="".concat(this.urlConf.createFile,"&").concat(t,"&bdstoken=").concat(Object(A["a"])()));var r={path:e.path,size:e.size,uploadid:e.uploadid,uploadsign:e.uploadsign,target_path:this._getTargetPath(e),block_list:n};r=this._formatTime(e,r);var s=null===(i=window.globalVue)||void 0===i||null===(i=i.$store)||void 0===i||null===(i=i.state)||void 0===i?void 0:i.webmaster,l=s.webmasterIdentity,u=l?"webmaster":"normal";Object($["b"])(a,{},r).then((function(t,i,n){var r;null===(r=window)||void 0===r||null===(r=r.globalVue)||void 0===r||r.$writeLog("action","web_uploadfile_normalUpload_success",{page:"main",fileSize:t.size,fileCount:1,authentication:u}),o=!0,e.callback(t,a,n)})).catch((function(t,i){var n,r;null===(n=window)||void 0===n||null===(n=n.globalVue)||void 0===n||n.$writeLog("action","web_uploadfile_normalUpload_fail",{errno:null!==(r=null===t||void 0===t?void 0:t.errno)&&void 0!==r?r:t,page:"main",apiType:"api_create_error",authentication:u}),o=!0,e.callback(t,a,i)}))}},{key:"rapidUpload",value:function(e,t){var i,n=!1;setTimeout((function(){n||e.callback&&e.callback({})}),this.conf.timeoutLimit);var o=this.urlConf.rapidUpload;if(t&&(o+="?".concat(t,"&bdstoken=").concat(Object(A["a"])())),y.getItem("noRapidUpload"))return n=!0,void e.callback("",o,{});var a={path:e.path,"content-length":e.size,"content-md5":e.contentMD5,"slice-md5":e.sliceMD5,target_path:this._getTargetPath(e)};a=this._formatTime(e,a);var r=null===(i=window.globalVue)||void 0===i||null===(i=i.$store)||void 0===i||null===(i=i.state)||void 0===i?void 0:i.webmaster,s=r.webmasterIdentity,l=s?"webmaster":"normal";Object($["b"])(o,{},a).then((function(t){var i;null===(i=window)||void 0===i||null===(i=i.globalVue)||void 0===i||i.$writeLog("action","web_uploadfile_rapidUpload_success",{page:"main",fileCount:1,authentication:l}),n=!0,e.callback(t,o)})).catch((function(t){var i,a,r=null!==(i=null===t||void 0===t?void 0:t.errno)&&void 0!==i?i:r;404!==r&&(null===(a=window)||void 0===a||null===(a=a.globalVue)||void 0===a||a.$writeLog("action","web_uploadfile_rapidUpload_fail",{page:"main",apiType:"api_rapidupload_error",authentication:l,errno:r}));n=!0,e.callback("",o)}))}},{key:"detectConnection",value:function(e){var t=this;this.conf.xhr||(this.conf.xhr=new XMLHttpRequest);var i=this.conf.xhr;i.onreadystatechange=function(){4===i.readyState&&(0===i.status?t.reLocateUpload()?t.detectConnection(e):"function"===typeof e.fail&&e.fail():(t.conf.xhr&&t.conf.xhr.abort(),"function"===typeof e.success&&e.success()))};try{i.open("POST",t.conf.serverUrl,!0),i.withCredentials=!0,i.send(new FormData)}catch(n){"function"===typeof e.fail&&e.fail()}}}],[{key:"getInstance",value:function(t){return e.instance||(e.instance=new e(t)),e.instance}}])}(),P=O,M=i("8f33"),j=i("262e"),N=(i("b0c0"),i("a9e3"),i("e6cf"),i("4d63"),i("c607"),i("2c3e"),i("466d"),i("0643"),i("4e3e"),i("159b"),function(){function e(){Object(v["a"])(this,e)}return Object(g["a"])(e,[{key:"onFileAccepted",value:function(e,t,i,n){}},{key:"onFileRemoved",value:function(){}},{key:"onFileError",value:function(){}},{key:"onFileSuccess",value:function(){}},{key:"onFileProgress",value:function(){}},{key:"onQueueClear",value:function(){}},{key:"onFileUploadStart",value:function(){}},{key:"onFilePause",value:function(){}},{key:"onFileContinue",value:function(){}},{key:"onFileLocked",value:function(){}},{key:"onGetServerPath",value:function(){return"/"}}],[{key:"check",value:function(){}}])}()),z=N,B=i("1095"),R=0,V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.button,n=t.mode,o=t.useDialog,a=t.uploadedFn,r=t.fileTypes;Object(v["a"])(this,e),this.button=i,this.mode=n,this.useDialog=o,this.fileTypes=r,this.uploadedFn=a,this.selectFileInput=[],this._init()}return Object(g["a"])(e,[{key:"_getCount",value:function(){return"h5Input"+R++}},{key:"_init",value:function(){var e=this;this.button&&(-90===this.mode?this._initForDirectory():this._initForm(this.button,-110===this.mode),window.globalVue.$watch("$store.state.lang",(function(t){var i="#menu_uploader-file",n="#menu_uploader-directory";setTimeout((function(){document.querySelector(i).innerText=window.globalVue.$t("main.upload.uploadFile"),document.querySelector(n).innerText=window.globalVue.$t("main.upload.uploadDir"),e._initForm(document.querySelector(i),!0,!1),e._initForm(document.querySelector(n),!0,!0)}),500)})))}},{key:"_detectSupportDirectory",value:function(){var e=document.createElement("input");return e.type="file","webkitdirectory"in e&&"multiple"in e}},{key:"_initForDirectory",value:function(){this._detectSupportDirectory()?(this.mode=-110,this._initForm(this.button,!0),this._initDropDown()):this._initForm(this.button,!0)}},{key:"_initDropDown",value:function(){var e="menu_uploader-file",t="menu_uploader-directory",i='\n            <ul class="dropdown-list nd-common-float-menu" style="display: none">\n                <li id="'.concat(e,'" class="sub cursor-p">').concat(window.globalVue.$t("main.upload.uploadFile"),'</li>\n                <li id="').concat(t,'" class="sub cursor-p">').concat(window.globalVue.$t("main.upload.uploadDir"),"</li>\n           </ul>     \n        "),n=w()(i),o=w()(this.button);o.append(n),o.on("mouseenter",(function(){n.show()})),o.on("mouseleave",(function(){n.hide()})),this._initForm(w()("#"+e),!0,!1),this._initForm(w()("#"+t),!0,!0)}},{key:"_initForm",value:function(e,t,i){var n=this,o=this._getCount();t=t?" multiple":"",i=i?"webkitdirectory":"";var a=i?window.globalVue.$t("main.upload.uploadDir"):window.globalVue.$t("main.upload.uploadFile");w()(e).addClass("upload-wrapper");var r=this.fileTypes||"*/*",s='\n            <input \n                title="'.concat(a,'" id="').concat(o,'" ').concat(t," ").concat(i,' accept="').concat(r,'" type="file" \n                name="html5uploader"\n                style="position:absolute;opacity:0;top:0;left:0;width:100%;height:100%;cursor:pointer;" />\n        '),l='<form class="h5-uploader-form" action="javascript:void(0);">'+s+"</form>";w()(e).append(l);var u=document.getElementById(o);u&&(u.onchange=function(e){e.preventDefault(),""===i?(window.globalVue.$writeLog("action","upload_btn_click_file"),n.onAddFiles(this.files,e.target.files,n.useDialog,n.uploadedFn)):(window.globalVue.$writeLog("action","upload_btn_click_folder"),n.onAddDirectory(this.files,n.useDialog,n.uploadedFn)),this.form&&this.form.reset(),Object(B["a"])("main_upload",{uploadType:""===i?"file":"folder"})},""===i&&this.selectFileInput.push(u))}},{key:"setFileTypes",value:function(e){for(var t=0,i=this.selectFileInput.length;t<i;t++)this.selectFileInput[t].setAttribute("accept",e)}},{key:"onAddFiles",value:function(){}},{key:"onAddDirectory",value:function(){}}])}(),H=V,G=function(){function e(){Object(v["a"])(this,e),this._init()}return Object(g["a"])(e,[{key:"_init",value:function(){this.conf={storageKey:"pan_uploader_info",expire:6048e5,info:null},this.conf.info=this._getAllStorageInfo(),"object"!==("undefined"===typeof sessionStorage?"undefined":Object(h["a"])(sessionStorage))||y.overwrite||sessionStorage.setItem(this.conf.storageKey,"")}},{key:"_getAllStorageInfo",value:function(){if(y&&JSON){var e=y.getItem(this.conf.storageKey);return e?JSON.parse(e):{}}}},{key:"_getFileMark",value:function(e){if(e.sMD5&&e.path)return e.lastModified+"-"+e.size+"-"+e.sMD5+"-"+e.path}},{key:"setUploadInfo",value:function(e,t){if(!(e.size<=262144)&&"undefined"!==typeof y&&"undefined"!==typeof JSON){var i=this._getFileMark(e),n=(new Date).getTime(),o=this.conf.info;for(var a in o)if(o.hasOwnProperty(a)){var r=o[a];n-r.date>this.conf.expire&&delete o[a]}o[i]={date:n,uploadId:e.uploadId,chunkMD5s:e.chunkMD5s};var s=JSON.stringify(o);if(y.setItem(this.conf.storageKey,s),t&&"object"===("undefined"===typeof sessionStorage?"undefined":Object(h["a"])(sessionStorage))){var l=sessionStorage.getItem(this.conf.storageKey);l||(l=""),-1===l.indexOf(e.uploadId)&&(l=l+";"+e.uploadId,sessionStorage.setItem(this.conf.storageKey,l))}}}},{key:"deleteUploadInfo",value:function(e){if(y&&JSON){var t=this._getFileMark(e),i=(new Date).getTime(),n=this.conf.info,o=n[t]&&n[t].uploadId;for(var a in delete n[t],n)n.hasOwnProperty(a)&&i-n[a].date>this.conf.expire&&delete n[a];var r=JSON.stringify(n);if(y.setItem(this.conf.storageKey,r),"object"===("undefined"===typeof sessionStorage?"undefined":Object(h["a"])(sessionStorage))){var s=sessionStorage.getItem(this.conf.storageKey);s&&-1!==s.indexOf(o)&&(s=s.replace(";"+o,""),sessionStorage.setItem(this.conf.storageKey,s))}}}},{key:"getUploadInfo",value:function(e){var t=this._getFileMark(e),i=this.conf.info[t];if(i&&i.uploadId&&"object"===("undefined"===typeof sessionStorage?"undefined":Object(h["a"])(sessionStorage))){var n=sessionStorage.getItem(this.conf.storageKey);if(n&&-1!==n.indexOf(i.uploadId))return{uploadId:i.uploadId,chunkMD5s:i.chunkMD5s,haveSame:!0};n=n+";"+i.uploadId,sessionStorage.setItem(this.conf.storageKey,n)}return i}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),K=G.getInstance(),Q=function(){function e(){Object(v["a"])(this,e),this._init()}return Object(g["a"])(e,[{key:"_init",value:function(){if(this.conf={chunkSize:4194304,blobSlice:"undefined"!==typeof File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice),workerUrl:"/node-static-v4/fe-webv4-main/assets/libs/md5.worker.js",workers:[]},"undefined"!==typeof Worker){var e=new Worker(this.conf.workerUrl);e.free=!0,this.conf.workers.push(e)}}},{key:"_getAFreeWorker",value:function(e){"undefined"===typeof e&&(e=0);var t=this.conf.workers[e];if(void 0===t){var i=new Worker(this.conf.workerUrl);return i.free=!0,this.conf.workers.push(i),i}return t.free?t:this._getAFreeWorker(++e)}},{key:"calculateMD5",value:function(e,t){var i=this._getAFreeWorker();i.free=!1;var n=new FileReader;if("undefined"!==typeof n.readAsArrayBuffer){var o=this.conf.blobSlice,a=parseInt(y.getItem("upload_chunk_size"),10),r=a||this.conf.chunkSize,s=Math.ceil(e.size/r),l=0,u=function(){var t=l*r,i=t+r>=e.size?e.size:t+r;if(!(t>=i))try{n.readAsArrayBuffer(o.call(e,t,i))}catch(a){setTimeout((function(){n.readAsArrayBuffer(o.call(e,t,i))}),100)}};n.onload=function(e){l++,i.postMessage(e.target.result),l<s?u():i.postMessage("dataEnd")},i.onmessage=function(e){"appendEnd"===e.data?u():(i.free=!0,t&&t(e.data))},u()}}},{key:"calculateMD5ForFirstSize",value:function(e,t){var i=!1;if(e.size<262144)return i=!0,t&&t(null),!1;var n=new FileReader;if("undefined"===typeof n.readAsArrayBuffer)return i=!0,void(t&&t(null));var o=this.conf.blobSlice,a=this._getAFreeWorker();a.free=!1,a.onmessage=function(e){"appendEnd"===e.data||i||(a.free=!0,i=!0,t&&t(e.data))},n.onload=function(e){a.postMessage(e.target.result),a.postMessage("dataEnd")},setTimeout((function(){!1===i&&(i=!0,t&&t(null))}),15e3),n.readAsArrayBuffer(o.call(e,0,262144))}},{key:"calculateMD5ForEveryChunk",value:function(e,t){var i=e.chunkMD5s?e.chunkMD5s:[],n=new FileReader;if("undefined"!==typeof n.readAsArrayBuffer){var o=this.conf.blobSlice,a=parseInt(y.getItem("upload_chunk_size"),10),r=a||this.conf.chunkSize,s=Math.ceil(e.size/r),l=0,u=this._getAFreeWorker();i.length=s,e.chunkMD5s=i,u.free=!1;var c=function(){if(void 0===i[l])if(l>=s)t&&t(i);else{var a=l*r,u=a+r>=e.size?e.size:a+r;if(!(a>=u))try{n.readAsArrayBuffer(o.call(e,a,u))}catch(d){setTimeout((function(){n.readAsArrayBuffer(o.call(e,a,u))}),100)}}else l<s&&(l++,c())};u.onmessage=function(e){"appendEnd"!==e.data&&(i[l-1]=e.data,l<s?c():(u.free=!0,t&&t(i)))},n.onload=function(e){u.postMessage(e.target.result),u.postMessage("dataEnd"),l++},c()}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}])}(),q=Q,W=window.globalVue,Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.dom,n=t.ctx;Object(v["a"])(this,e),this.dom=("string"===typeof i?w()(i):i)||document.body,this.ctx=n,this.clipboardTextStoreKey="clipboardText",this.pasteCount=function(){if(!/chrome\/\d/i.test(navigator.userAgent))return!1;var e=y.getItem("pasteCount");return e&&e.length>0&&(e=parseInt(e,10)),"number"!==typeof e&&(e=0),e}(),this._init()}return Object(g["a"])(e,[{key:"_init",value:function(){this._initEvent(),this._initCanvas()}},{key:"_initEvent",value:function(){var e=this,t=this;w()(document).on({dragstart:function(){return!1},dragleave:function(e){e.preventDefault()},drop:function(e){e.preventDefault()},dragenter:function(e){e.preventDefault()},dragover:function(e){e.preventDefault()}}),w()(this.dom).on({dragenter:function(e){if(!t._isFileDrag(e))return!1;t._showCanvas()}}),w()(window).bind("paste",(function(i){if(!1!==t.pasteCount){var n=i.target.nodeName;if(!/input|textarea/i.test(n)){var o=i.originalEvent,a=(o||i).clipboardData;(!/chrome\/\d/i.test(navigator.userAgent)||a&&a.items&&a.items.length)&&(i.preventDefault(),2===t.pasteCount?t.ctx.$bus.$emit(e.ctx.busEvents.uploaderConfirmDialog,{title:W.$t("main.upload.startCopyUpload"),content:W.$t("main.upload.copyContent1")+"<br/>"+W.$t("main.upload.copyContent2"),okText:W.$t("header.confirm"),okFn:function(){e.ctx.$bus.$emit(e.ctx.busEvents.uploaderConfirmDialog,!1)},showCancelBtn:!1,show:!0}):t.pasteCount>2&&t._handleClipboard(a),y.setItem("pasteCount",++t.pasteCount))}}})),w()(window).bind("keydown",(function(e){if(!1!==t.pasteCount){var i=e.target.nodeName;if(!/input|textarea/i.test(i)&&13===e.keyCode&&(e.ctrlKey||e.metaKey)){var n=y.getItem(t.clipboardTextStoreKey);if("string"===typeof n&&n.length){var o=new Blob([n],{type:"text/plain"});o.name=W.$t("main.upload.text")+t._getTimeName()+".txt",y.setItem(t.clipboardTextStoreKey,""),t.onDragFile(o)}}}}))}},{key:"_getTimeName",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+"_"+t.getMinutes()+"_"+t.getSeconds()+"".concat(e?" "+t.getMilliseconds():"")}},{key:"_isFileDrag",value:function(e){var t=e.dataTransfer.types;return t.indexOf("Files")>-1}},{key:"_initCanvas",value:function(){var e=this;this.canvas||(this.canvas=w()('<div class="upload-drag_tip">'+W.$t("main.upload.uploadToThisDir")+"</div>"),w()("body").append(this.canvas),this.canvas[0].addEventListener("drop",(function(t){if(t.preventDefault(),w()(this).hide(),!e._isFileDrag(t))return!1;for(var i=t.dataTransfer.files,n=t.dataTransfer.items,o=t.dataTransfer.types,a=new Array,r=0,s=0,l=function(t,i){if(i=i||"",t.isFile)t.file((function(t){t.directoryPath=i+t.name,a.push(t);var n=r-s+1;a.length===n&&e.onDragDirectory(a)}));else if(t.isDirectory){var n=t.createReader();n.readEntries((function(e){s+=1,r+=e.length,e.forEach((function(e){l(e,i+t.name+"/")}))}))}},u=0;u<i.length;u++)if(n&&n[u]){var c=n[u].webkitGetAsEntry();c.isFile?e.onDragFile(i[u]):c.isDirectory&&l(c)}else o.length>1&&(""===i[u].type||"undefined"===typeof i[u].type)?this.ctx.$Message({type:"warning",message:W.$t("main.upload.browserNotSupport")}):e.onDragFile(i[u])}),!1),this.canvas.on({dragleave:function(){w()(this).hide()},click:function(){w()(this).hide()},mouseover:function(){w()(this).hide()}}))}},{key:"_showCanvas",value:function(){var e=w()(this.dom).height();this.canvas.css({"line-height":"".concat(e,"px")}).show()}},{key:"_handleClipboard",value:function(e){var t=this;if(!/chrome\/\d/i.test(navigator.userAgent)||e&&e.items&&e.items.length)try{var i;if(e.items&&(i=e.items[0])&&"file"===i.kind&&0===i.type.indexOf("image")){var n=i.getAsFile();new Date;try{n.name=t._getTimeName()+".png"}catch(r){console.log(r)}t.onDragFile(n)}else{var o={message:"",type:"success"};if(!(i=e.getData("text/plain"))||1!==e.types.length&&"text/html"!==e.types[1])Object.assign(o,{type:"warning",message:W.$t("main.upload.onlyImgAndText")});else{if("text/plain"!==e.types[0])return;var a=y.getItem(t.clipboardTextStoreKey);a||(a=""),a+="\n"+t._getTimeName(!1)+W.$t("main.upload.copyText")+"\n\n",i=a+i+"\n\n",y.setItem(t.clipboardTextStoreKey,i),Object.assign(o,{type:"success",message:W.$t("main.upload.controlAndEnter")})}this.ctx.$Message(o)}}catch(r){console.log(r)}}},{key:"onDragFile",value:function(e){}},{key:"onDragDirectory",value:function(e){}},{key:"notSupportDirectory",value:function(){}}])}(),J=Y,X=i("6df4"),Z=i("8b1a"),ee=!1,te=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=i.ctx,a=i.button,r=(i.serverUrl,i.mode);return Object(v["a"])(this,t),e=Object(M["a"])(this,t),e.ctx=o,e.fileHandler=q.getInstance(),n=P.getInstance(o),e.button=a,e.mode=r||e.MUTIIPLE_MODE,e.autoUpload=!0,e.fileQueue=[],e.uploadLimit=3,e.chunkRetryLimit=3,e.chunkThread=0,e.uploadingNum=0,e.uploadIndex=0,e.createParams="",e.alertDialog=null,e.currentUplodFileSize=0,e._init(),ee||(ee=!0,e._initDrag(e.ctx)),e.ctx&&e.ctx.userInfo&&0===e.ctx.userInfo.vipType&&(e.uploadLimit=1),e.hasEnougtSpacing=!0,e._hasEnoughSpacing(),e}return Object(j["a"])(t,e),Object(g["a"])(t,[{key:"_init",value:function(){var e,t=null===(e=window.globalVue)||void 0===e||null===(e=e.$store)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.teraBaseConfig,i=t.fe_upload_file_chunk_count;this.chunkThread=isNaN(i)?5:Number(i),this.MUTIIPLE_MODE=-110,this.SINGLE_MODE=-100,this.DIRECTORY_MODE=-90,this.QUEUE_LIMIT=300,this.PC_QUEUE_LIMIT=500,this.FILE_NUM_PC_GUIDE=100,this.FILE_SIZE_LIMIT=4294967296,this.FILE_SIZE_MAX=137438953472,this.FILE_SIZE_MID=10737418240,this.FILE_SIZE_PC_GUIDE=2147483648,this.FILE_CHUNK_SIZE=4194304,this.FILE_STATUS_PENDING=-1,this.FILE_STATUS_UPLOADING=-2,this.FILE_STATUS_COMPLETE=-4,this.FILE_STATUS_CANCEL=5,this.FILE_STATUS_PAUSE=6,this.FILE_STATUS_ERROR=-3,this.FILE_STATUS_FILEERROR=0,this.statusMsg={"-90":this.ctx.$t("main.rename.wrongName"),"-100":this.ctx.$t("main.upload.emtpyFile"),"-110":this.ctx.$t("main.upload.over4g"),"-111":this.ctx.$t("main.upload.over4g"),"-112":this.ctx.$t("main.upload.over4g"),"-113":this.ctx.$t("main.upload.over4g"),"-114":this.ctx.$t("main.upload.over4g"),"-115":this.ctx.$t("main.upload.over128g"),"-130":this.ctx.$t("main.upload.overCount"),"-1009":this.ctx.$t("main.upload.taskIsExist"),9100:this.ctx.$t("main.upload.block"),9200:this.ctx.$t("main.upload.block"),9300:this.ctx.$t("main.upload.block"),9400:this.ctx.$t("main.upload.block"),9500:this.ctx.$t("main.upload.block"),31047:this.ctx.$t("main.reloadMsg")+this.ctx.$t("main.refresh"),"010":this.ctx.$t("main.upload.overTime"),"020":this.ctx.$t("main.errMsg.err1"),"030":this.ctx.$t("main.upload.overTime"),121:this.ctx.$t("main.upload.over500w"),"050":this.ctx.$t("main.upload.fileErr"),59:this.ctx.$t("main.upload.videoOverSize",{size:"".concat(this.ctx.$store.state.membership.videoUploadLimitSize,"MB")}),58:this.ctx.$t("main.upload.fileOverSize",{size:"".concat(this.ctx.$store.state.membership.otherFileUplaodLimitSize,"GB")})},this._initH5Form()}},{key:"_initH5Form",value:function(e,t,i,n,o){var a=this;this.h5Forms=new H({button:e||this.button,mode:t||this.mode,useDialog:i,uploadedFn:n,fileTypes:o}),this.h5Forms.onAddFiles=function(e,t,i,n,o){a._multiFilesAdded(e,t,i,n)},this.h5Forms.onAddDirectory=function(e,t,i,n){a._multiFilesAdded(e,t,i,n)}}},{key:"_getSliceSize",value:function(e){return e>4294967296&&window.globalVue.$writeLog("action","web_upload_size_over4g_clk",{fileSize:Object(Z["f"])(e)}),e<=4294967296?4194304:e<=8589934592?8388608:e<=17179869184?16777216:e<=34359738368?33554432:e<=68719476736?67108864:e<=137438953472?134217728:void 0}},{key:"_initDrag",value:function(e){var t=this,i=new J({dom:".main-page",ctx:e});i.onDragFile=function(e){t._multiFilesAdded(e)},i.onDragDirectory=function(e){t._multiFilesAdded(e)},i.notSupportDirectory=function(){t.ctx.$Message({type:"warning",message:"暂不支持文件夹的拖拽上传"})}}},{key:"_hasEnoughSpacing",value:function(){this.hasEnougtSpacing=!0}},{key:"_getAppVersionAsync",value:function(){var e=this;return this.appData?new Promise((function(t){t(e.appData)})):this.ctx.$http.request.get("/disk/cmsdata?do=client",{params:{}}).then((function(t){if(t&&0===t.errorno){var i=navigator.platform.indexOf("Mac"),n=i>=0?t.mac:t.guanjia;return e.appData=n,n}return{}}))}},{key:"uploadGuideDialog",value:function(e,t,i){var n="size"===e?this.ctx.$t("main.upload.over2g"):this.ctx.$t("main.upload.over100"),o="size"===e?this.ctx.$t("main.upload.premium20g"):this.ctx.$t("main.upload.premiumUpload"),a=['<div class="dialog-content">'+n+"</div>"].join("");i.ctx.$bus.$emit(this.ctx.busEvents.uploaderConfirmDialog,{title:this.ctx.$t("main.upload.upload"),content:a,okText:this.ctx.$t("main.upload.goToPc"),cancelText:this.ctx.$t("main.upload.continue"),okFn:function(){window.location.href="terabox://launch-app",setTimeout((function(){i.guideDownloadPcDialog(e)}),5e3)},cancelFn:function(){i._multiFilesAdded(t,null,null,null,!0)},showCancelBtn:!0,show:!0}),document.querySelectorAll(".bottom-box").forEach((function(e){e.style.display="none"})),w()("#uploaderConfirmDialog .u-dialog").append('<div class="bottom-box"><div>'+o+'</div><div class="buy-button"><span>'+this.ctx.$t("main.delete.guideVip")+'</span><span class="icon icon-arrow-right"></span></div></div>'),this.autoBtnWidth("continue-btn","go-to-pc-btn"),w()(".bottom-box").click((function(){window.location.href="/cloud-storage-pricing-plans?subscribe=1&purchaseReason=guide_pc"})),i.ctx.$store.state.login.isPremium&&w()(".bottom-box").hide()}},{key:"guideDownloadPcDialog",value:function(e){var t=this,i="size"===e?this.ctx.$t("main.upload.premium20g"):this.ctx.$t("main.upload.premiumUpload"),n=['<div class="dialog-content">',this.ctx.$t("main.upload.downloadPcAndUpload"),"</div>"].join("");t.ctx.$bus.$emit(this.ctx.busEvents.uploaderConfirmDialog,{title:this.ctx.$t("main.upload.notHavePc"),content:n,okText:this.ctx.$t("main.upload.downloadPc"),cancelText:t.ctx.$t("transfer.cancel"),okFn:function(){t.guidePcDefault()},showCancelBtn:!0,show:!0}),document.querySelectorAll(".bottom-box").forEach((function(e){e.style.display="none"})),w()("#uploaderConfirmDialog .u-dialog").append('<div class="bottom-box"><div>'+i+'</div><div class="buy-button"><span>'+this.ctx.$t("main.delete.guideVip")+'</span><span class="icon icon-arrow-right"></span></div></div>'),this.autoBtnWidth("close-btn","go-to-pc-btn"),w()(".bottom-box").click((function(){window.location.href="/cloud-storage-pricing-plans?subscribe=1&purchaseReason=guide_pc"})),t.ctx.$store.state.login.isPremium&&w()(".bottom-box").hide()}},{key:"autoBtnWidth",value:function(e,t){var i=w()(".".concat(e)).width(),n=w()(".".concat(t)).width(),o=Math.ceil(Math.max(i,n));w()(".".concat(e)).width(o),w()(".".concat(t)).width(o)}},{key:"_multiFilesAdded",value:function(e,t,i,n,o){var a,r,s=this;e&&"undefined"===typeof e.length&&(e=[e]);var l=this.fileQueue.length,u=e.length+l,c=[],d=null===(a=window.globalVue)||void 0===a||null===(a=a.$store)||void 0===a||null===(a=a.state)||void 0===a?void 0:a.webmaster,p=d.webmasterIdentity,f=p?"webmaster":"normal";if(null===(r=window)||void 0===r||null===(r=r.globalVue)||void 0===r||r.$writeLog("action","web_uploadfile_start_upload",{page:"main",fileCount:e.length,authentication:f}),s.isWin()&&!o){for(var h=!1,v=0,g=e.length;v<g;v++)_=e[v],c.push(_),_.size>s.FILE_SIZE_PC_GUIDE&&_.size<s.FILE_SIZE_LIMIT&&(h=!0);if(u>s.QUEUE_LIMIT){var m=['<div style="color: #495366;font-weight: normal;font-size: 14px;">',this.ctx.$t("main.upload.over300"),"</div>"].join("");return s.ctx.$bus.$emit(this.ctx.busEvents.uploaderConfirmDialog,{title:this.ctx.$t("header.prompt"),content:m,okText:this.ctx.$t("main.upload.downloadPc"),okFn:function(){s.guidePcDefault()},showCancelBtn:!1,show:!0}),document.querySelectorAll(".bottom-box").forEach((function(e){e.style.display="none"})),w()("#uploaderConfirmDialog .u-dialog").append('<div class="bottom-box">'+this.ctx.$t("main.upload.premium20g")+"</div>"),w()(".bottom-box").click((function(){window.location.href="/cloud-storage-pricing-plans?subscribe=1&purchaseReason=bigFile"})),void(s.ctx.$store.state.login.isPremium&&w()(".bottom-box").hide())}if(h)return void s.uploadGuideDialog("size",c,s);if(u>s.FILE_NUM_PC_GUIDE)return void s.uploadGuideDialog("num",c,s)}for(var _=null,y=0,b=e.length;y<b;y++)if(_=e[y],y+l>s.QUEUE_LIMIT)this._eventAddFileFailed(_,"-130");else if(s.hasEnougtSpacing){if("."!==_.name||0!==_.size){var k=s.ctx.$store.state.login.isPremium;_.size>s.FILE_SIZE_MAX&&k?this._eventAddFileFailed(_,"-115"):""===_.name||"."===_.name||/[\\\/\:\*\?\"\<\>\|]/.test(_.name)?this._eventAddFileFailed(_,"-90"):0===_.size?this._eventAddFileFailed(_,"-100"):this._eventAddNewFile(_,t,i,n)}}else this._eventAddFileFailed(_,"-10")}},{key:"isWin",value:function(){var e=navigator.userAgent.toLowerCase(),t=/Windows/i;return t.test(e)}},{key:"isGeWin7",value:function(){var e=navigator.userAgent.toLowerCase(),t=/(Windows) NT ([0-9.]+)/i,i=t.exec(e.toLowerCase());try{if(i&&i[2]){var n=parseFloat(i[2]);return n>=6.1}}catch(o){console.warn(o)}return!1}},{key:"guidePcDefault",value:function(){var e=this,t=Object(X["A"])("lang")||Object(X["u"])("lang")||window.navigator.language||"en";"en_US"===t&&(t="en"),"zh_CN"===t&&(t="zh"),!e.isWin()||e.isGeWin7()?w.a.getJSON("/api/getsyscfg",{cfg_category_keys:'[{"cfg_category_key": "fe_web_guide_setting","cfg_version": 1}]',version:0,language_type:t,channel:"dubox",web:1,app_id:250528,clienttype:0},(function(t){t&&0===t.errno?window.open(t.fe_web_guide_setting.cfg_list[0].url||""):window.location.href=e.$t("pcDownload")})):window.open("https://data."+m["h"]+"/issue/terabox/PCTeraBox/TeraBox_1.6.2.1.exe")}},{key:"_eventAddNewFile",value:function(e,t,i,n){e.status!==this.FILE_STATUS_ERROR&&(e.status=this.FILE_STATUS_PENDING),e.index=this.fileQueue.length,e.useDialog=i,e.uploadedFn=n,e.server_path=this.onGetServerPath();var o=e.webkitRelativePath?e.webkitRelativePath:e.name,a=e.directoryPath?e.directoryPath:o;e.path=e.server_path.lastIndexOf("/")===e.server_path.length-1?e.server_path+a:e.server_path+"/"+a,this.fileQueue.push(e),this.onFileAccepted(e,null,null,t)}},{key:"_eventAddFileFailed",value:function(e,t){e.status=this.FILE_STATUS_ERROR,e.retry=!1,this._eventAddNewFile(e);var i=this.statusMsg[t]||t;this.onFileError(e,i,t)}},{key:"_checkInCompleteFile",value:function(){for(var e=0,t=this.fileQueue.length;e<t;e++){var i=this.fileQueue[e];if(i.status===this.FILE_STATUS_PENDING)return e}return!1}},{key:"_handleFileMD5",value:function(e){var t,i=this,n=null===(t=window.globalVue)||void 0===t||null===(t=t.$store)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.webmaster,o=n.webmasterIdentity,a=o?"webmaster":"normal";e.size>262144&&o?(setTimeout((function(){e.cMD5&&e.sMD5||!e.onceError||i._eventUploadError(e,"010")}),24e4),window.globalVue.$writeLog("action","web_uploadfile_start_md5",{page:"main",authentication:a}),this.fileHandler.calculateMD5(e,(function(t){var n;null===(n=window)||void 0===n||null===(n=n.globalVue)||void 0===n||n.$writeLog("action","web_uploadfile_md5_success",{page:"main",fileCount:1,authentication:a}),e.cMD5=t,e.pause||e.status===i.FILE_STATUS_CANCEL||i._rapidUpload(e)})),this.fileHandler.calculateMD5ForEveryChunk(e,(function(t){for(var n=0;n<t.length;n++)t[n];K.setUploadInfo(e,e.status===i.FILE_STATUS_UPLOADING)}))):e.rapidEnd=!0}},{key:"_handleFileData",value:function(e){var t=this,i=!1;this.fileHandler.calculateMD5ForFirstSize(e,(function(n){i||(n&&(i=!0),e.sMD5=n,t._getUploadInfo(e,(function(e){t._sendFileInChunkStyle(e),t._handleFileMD5(e)})))}))}},{key:"_eventUploadProcess",value:function(e,t,i,n){if(e.status===this.FILE_STATUS_UPLOADING){var o,a;o=t>=i?100:(t/i*100).toFixed(2),"undefined"===typeof e.lastComplete&&(e.lastComplete=0),a=(t-e.lastComplete)/(n||1),a=a<0?0:a,e.speed.length>=10&&e.speed.shift(),e.speed.push(a);for(var r=0,s=0,l=e.speed.length;s<l;s++)r+=e.speed[s];a=r/e.speed.length,e.lastComplete=t,this.onFileProgress(e,o,a)}}},{key:"_eventUploadSucceed",value:function(e,t){e.status!==this.FILE_STATUS_COMPLETE&&(e.status=this.FILE_STATUS_COMPLETE,this.uploadingNum--,this.autoUpload&&this.upload(),this.onFileSuccess(e,t))}},{key:"_eventUploadError",value:function(e,t,i,n){if(this.uploadingNum--,e.status!==this.FILE_STATUS_CANCEL&&e.status!==this.FILE_STATUS_COMPLETE&&(this.autoUpload&&this.upload(),e.status!==this.FILE_STATUS_ERROR)){e.status=this.FILE_STATUS_ERROR;var o=this.statusMsg[t]||t;this.onFileError(e,o,t,i,n)}}},{key:"_createFile",value:function(e,t){if(this.fileQueue.length&&e.status!==this.FILE_STATUS_COMPLETE){var i=this;if(!e.creating)if(e.rapidUploading)e.afterRapidError=function(){e.rapidUploading=!1,i._createFile(e,t)};else{e.creating=!0;var o=function(t,n,o){e.creating=!1,K.deleteUploadInfo(e),!t||0!==t.errno&&"0"!==t.errno?(e.afterCreateError&&e.afterCreateError(),i._eventUploadError(e,t.errno,"netdisk",200)):(e.fs_id=t.fs_id,e.md5=t.md5,t.uploadType="create",i._eventUploadSucceed(e,t))};"object"===Object(h["a"])(t)&&t.length&&(t=JSON.stringify(t));var a={path:e.path,size:e.size,uploadid:e.uploadId,uploadsign:e.uploadSign,file:e,blockList:t,callback:o};e.lastModified&&(a.local_mtime=e.lastModified),n.create(a,this.createParams)}}}},{key:"_sendFileInChunkStyle",value:function(e){e.blockList=[],e.speed=[];var t=this,i="undefined"!==typeof File&&(File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice);if(i){var o=y&&parseInt(y.getItem("upload_chunk_size"),10),a=o||t._getSliceSize(e.size),r=Math.ceil(e.size/a),s=-1,l=[],u=0,c=0,d="",p="";e.startProcess=function(){e.progressInterval=window.setInterval((function(){t.currentUplodFileSize=u,t._eventUploadProcess(e,u,e.size,.5)}),500)},e.startProcess();var f=function(i,n){u-=l[i]||0,l[i]=n,u+=n,u>=e.size&&(t._eventUploadProcess(e,e.size,e.size,.5),window.clearInterval(e.progressInterval))},h=function(t){if("number"!==typeof t){if(++s>=r)return null;t=s}var n=t*a,o=n+a>=e.size?e.size:n+a;return n>=o?null:i.call(e,n,o)},v=function(){if(d.length>0){var e=parseInt(d.match(/\d+/)[0],10),i=new RegExp("\\|"+e+"\\|","g");return d=d.replace(i,""),!(p.match(i).length>t.chunkRetryLimit)&&e}return null},g=function(i,o,a,r){window.fileIsBeingUploaded=!0;var s=o;if(e.status===t.FILE_STATUS_COMPLETE||e.status===t.FILE_STATUS_ERROR&&!1===e.retry||e.status===t.FILE_STATUS_CANCEL||!0===e.pause)window.clearInterval(e.progressInterval);else{var l=t._compileUrl(n.conf.serverUrl,e,s),u=function(t,n){window.fileIsBeingUploaded=!1,f(s,i.size,i.size),e.blockList[s]=t.md5,r(a,s)},c=function(e,t){r(a,s,!0,!1,e,t)};if("all"!==e.listUploadNum&&-1===e.listUploadNum.indexOf("|"+s+"|"))return"undefined"===typeof e.lastComplete?e.lastComplete=i.size:e.lastComplete+=i.size,void u({md5:e.chunkMD5s[s]});t._callXHR(i,{onsuccess:u,onerror:function(e,t,n){f(s,0,i.size),c(e,n.status)},onprogress:function(e){f(s,e.loaded,e.total)}},l,a)}},m=function(){for(var i=function(n,o,a,l,u,f){if(!l&&(a?(d+="|"+o+"|",p+="|"+o+"|"):c++,c>=r))return e.status!==t.FILE_STATUS_COMPLETE&&(t.onFileLocked(e),t._createFile(e,e.blockList)),t._eventUploadProcess(e,e.size,e.size),void window.clearInterval(e.progressInterval);if(e.status!==t.FILE_STATUS_COMPLETE){if(e.pause)return n=null,void(e.pauseGoOn=null);var m=h();if(m)g(m,s,n,i);else{var _=v();"number"===typeof _?g(h(_),_,n,i):!1===_?(e.rapidEnd?(e.pause=!0,t._eventUploadError(e,u,"pcs",f)):(e.onceError=!0,e.errorCode=u,e.errorStatus=f),n=null):n=null}}},n=0;n<t.chunkThread&&n<r;n++)setTimeout((function(){i(new XMLHttpRequest,-1,!1,!0)}),1e3*n)};e.goOn=function(){e.status===t.FILE_STATUS_UPLOADING&&t.onFileContinue(e),e.pause=!1,e.startProcess(),t._rapidUpload(e),m()},m()}}},{key:"_callXHR",value:function(e,t,i,n){n||(n=new XMLHttpRequest,e.h5Kernal=n);var o=e;return"undefined"!==typeof FormData&&(o=new FormData,o.append("file",e)),n.upload.onabort=function(){},n.onreadystatechange=function(){if(4===n.readyState){var e=n.responseText;if("string"===typeof e)try{e=w.a.parseJSON(e)}catch(i){}if(200===n.status){if("d41d8cd98f00b204e9800998ecf8427e"===e.md5)return void t.onerror("050",e,n);t.onsuccess(e,n)}else e?t.onerror(e.error_code,e,n):t.onerror(void 0,e,n)}},n.upload.onprogress=function(e){t.onprogress(e)},n.open("POST",i,!0),n.withCredentials=!0,n.timeout=72e4,n.ontimeout=function(e){t.onerror("030",void 0)},n.send(o),n}},{key:"_compileUrl",value:function(e,t,i){return e+"&path="+encodeURIComponent(t.path)+"&uploadid="+(t.uploadId||0)+"&uploadsign="+(t.uploadSign||0)+"&partseq="+(i||0)}},{key:"_rapidUpload",value:function(e){var t=this;if(this.fileQueue.length&&e.status!==t.FILE_STATUS_ERROR&&e.status!==t.FILE_STATUS_COMPLETE&&e.cMD5&&e.sMD5){if(e.creating)return void(e.afterCreateError=function(e){return function(){e.creating=!1,t._rapidUpload(e)}}(e));e.rapidUploading=!0;var i=function(i,n,o){e.rapidUploading=!1;!i||0!==i.errno&&"0"!==i.errno?!i||-10!==i.errno&&"-10"!==i.errno?(e.afterRapidError&&e.afterRapidError(),e.onceError&&("undefined"!==typeof e.errorStatus?t._eventUploadError(e,e.errorCode,"pcs",e.errorStatus):t._eventUploadError(e,i.errno,"netdisk",200))):(e.retry=!1,t._eventUploadError(e,i.errno,"netdisk",200)):(e.fs_id=i.info.fs_id,e.h5Kernal&&e.h5Kernal.abort(),K.deleteUploadInfo(e),t._eventUploadSucceed(e,{msg:"秒传",uploadType:"rapidUpload"})),e.rapidEnd=!0},o={path:e.path,size:e.size,contentMD5:e.cMD5,sliceMD5:e.sMD5,file:e,callback:i};e.lastModified&&(o.local_mtime=e.lastModified),n.rapidUpload(o,this.createParams)}}},{key:"_getUploadInfo",value:function(e,t){var i,o='["5910a591dd8fc18c32a8f3df4fdc1761","a5fc157d78e6ad1c7e114b056c92821e"]';if(e.size>262144&&(i=K.getUploadInfo(e)),i&&i.uploadId&&(e.uploadId=i.uploadId,e.uploadSign=i.uploadSign,e.chunkMD5s=i.chunkMD5s,o=e.chunkMD5s,i.haveSame))this._eventUploadError(e,"-1009");else{var a=this,r=function(n,o,r){var s={};n&&0===n.errno?(e.uploadId=e.uploadId?e.uploadId:n.uploadid,e.uploadSign=e.uploadSign?e.uploadSign:n.uploadsign,e.listUploadNum=i&&i.uploadId?"|"+n.block_list.join("||")+"|":"all",void 0!==e.uploadId?t(e):(n.errno=1,a._eventUploadError(e,1,"netdisk",200),s.success=0,s.reason="precreate")):(a._eventUploadError(e,n.errno,"netdisk",r&&r.status),s.success=0,s.reason="precreate"),"number"===typeof s.success&&Object.assign(s,{from:"H5Uploader",ajaxurl:o,ajaxstatus:r&&r.status,ajaxerrno:n.errno,ajaxdata:JSON.stringify(n),file:JSON.stringify(Object.assign({},e))})},s={path:e.path,file:e,uploadid:e.uploadId,uploadsign:e.uploadSign,blockList:o,callback:r};e.size<=this.FILE_CHUNK_SIZE&&(s.blockList='["5910a591dd8fc18c32a8f3df4fdc1761"]'),n.preCreate(s)}}},{key:"setMode",value:function(e){e!==this.MUTIIPLE_MODE&&e!==this.SINGLE_MODE||(this.mode=e)}},{key:"addButton",value:function(e,t,i,n,o){this._initH5Form(e,t,i,n,o)}},{key:"setFileTypes",value:function(e){this.h5Forms.setFileTypes(e)}},{key:"setUrlParams",value:function(e){if("string"===typeof e&&-1!==e.indexOf("=")){var t=e.substring(0,e.indexOf("="));if(-1!==this.createParams.indexOf(t)){var i=new RegExp(t+"\\=[^&=]*","ig");this.createParams=this.createParams.replace(i,e)}else this.createParams.length?this.createParams+="&"+e:this.createParams=e}}},{key:"upload",value:function(e,i){if("boolean"===typeof i&&(this.autoUpload=i),this.uploadingNum>=this.uploadLimit)"object"===Object(h["a"])(e)&&e.status===t.FILE_STATUS_CANCEL&&!1!==e.retry&&(e.status=this.FILE_STATUS_PENDING,this.onFileInQueue&&this.onFileInQueue(e));else{var n,o=!1,a=!1;if("number"===typeof e?(n=this.fileQueue[e],this.uploadIndex=e):"undefined"===typeof e?(o=!0,n=this.fileQueue[this.uploadIndex]):"object"===Object(h["a"])(e)&&(a=!0,n=e),n){if(n.pause&&n.goOn)return this.uploadingNum++,n.status=this.FILE_STATUS_UPLOADING,void n.goOn();a||n.status===this.FILE_STATUS_PENDING||n.status===this.FILE_STATUS_ERROR&&!1!==n.retry?(n.pause=!1,this.uploadingNum++,n.status=this.FILE_STATUS_UPLOADING,this._handleFileData(n),this.onFileUploadStart(n),o&&this.uploadIndex++):o&&(this.uploadIndex++,this.upload())}else{var r=this._checkInCompleteFile();!1!==r&&(this.uploadIndex=r,this.upload())}}}},{key:"remove",value:function(e,t,i){var n;if(n="number"===typeof e?this.fileQueue[e]:e,n){var o=!1;n.status===this.FILE_STATUS_UPLOADING&&(this.uploadingNum--,o=!0),n.status=this.FILE_STATUS_CANCEL,n.lastComplete=void 0,n.retry=void 0,n.pause=void 0,clearInterval(n.progressInterval),K.deleteUploadInfo(n),n.h5Kernal&&n.h5Kernal.abort(),this.autoUpload&&o&&!0!==i&&this.upload(),!0!==t&&this.onFileRemoved(n)}}},{key:"pause",value:function(e){var t;if(t="number"===typeof e?this.fileQueue[e]:e,t){if(t.rapidUploading||t.creating)return;t.pause=!0,t.status===this.FILE_STATUS_UPLOADING?(this.uploadingNum--,t.status=this.FILE_STATUS_PAUSE,this.onFilePause(t),this.autoUpload&&this.upload()):(t.status=this.FILE_STATUS_PAUSE,this.onFilePause(t))}}},{key:"goOn",value:function(e){"function"===typeof e.pauseGoOn?e.pauseGoOn():(clearInterval(e.progressInterval),this.upload(e))}}],[{key:"check",value:function(){return"undefined"!==typeof File&&"undefined"!==typeof FileReader}},{key:"getInstance",value:function(e){return t.instance||(t.instance=new t(e)),t.instance}}])}(z),ie=te,ne=function(){function e(){Object(v["a"])(this,e)}return Object(g["a"])(e,[{key:"_init",value:function(){}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"check",value:function(){return!1}}])}(),oe=ne.getInstance(),ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{mode:-110,fileTypes:"*"},i=t.ctx,n=t.button,o=t.mode,a=t.fileTypes,r=t.uploadPath,s=t.afterInit,l=t.messageFor;Object(v["a"])(this,e),this.ctx=i,this._init(),this.button=n,this.messageFor=l||"",this.mode=o||-110,this.fileTypes=a,this.uploadPath=r,this.uploaderCore=null,this.afterInit=s||[];var u=this,c=P.getInstance(this.ctx);c.init((function(){var e=!1,t=function(){if(!e){e=!0,u._initUploaderCore(),u.fileTypes&&u.uploaderCore.setFileTypes(this.fileTypes),u._setReplaceType(),u._initEvents();for(var t=0,i=u.afterInit.length;t<i;t++)"function"===typeof u.afterInit[t]&&u.afterInit[t].call(u)}};t()}))}return Object(g["a"])(e,[{key:"_init",value:function(){this.TYPE_FLASH="flash",this.TYPE_NATIVE="native",this.TYPE_H5="h5",this.typeOrder=[this.TYPE_NATIVE,this.TYPE_H5,this.TYPE_FLASH],this.errorMsg={"-7":this.ctx.$t("main.rename.wrongName"),"-10":this.ctx.$t("main.upload.notEnoughSpace"),31045:this.ctx.$t("main.reloadMsg")+this.ctx.$t("main.refresh"),31047:this.ctx.$t("main.reloadMsg")+this.ctx.$t("main.refresh"),"-6":this.ctx.$t("main.reloadMsg")+this.ctx.$t("main.refresh"),9100:this.ctx.$t("main.upload.block"),9200:this.ctx.$t("main.upload.block"),9300:this.ctx.$t("main.upload.block"),9400:this.ctx.$t("main.upload.block"),9500:this.ctx.$t("main.upload.block")}}},{key:"_initUploaderCore",value:function(){for(var e=!1,t=this.typeOrder,i=0,n=t.length;i<n;i++){var o=t[i],a=!1;if(this.type===o&&(e=!0),this.type&&!e&&(a=!0),o===this.TYPE_NATIVE?this.uploaderCore=this.initNativeCore(a):o===this.TYPE_H5?this.uploaderCore=this.initH5Core(a):o===this.TYPE_FLASH&&(this.uploaderCore=this.initFlashCore(a)),a&&(this.uploaderCore=null),null!==this.uploaderCore&&"object"===Object(h["a"])(this.uploaderCore)){this.type=o;break}}}},{key:"initNativeCore",value:function(e){return!1}},{key:"initH5Core",value:function(e){return!!ie.check()&&(e?void 0:ie.getInstance({ctx:this.ctx,button:this.button,mode:this.mode}))}},{key:"initFlashCore",value:function(e){if(!oe.check())return!1;if(!e){var t=y.getItem("flashUploadUrl"),i=interactive.conf.serverUrl;i+="&type=tmpfile",t&&(i=t);var n=-110===this.mode||-100===this.mode?this.mode:-110;return new oe(this.button,i,n)}}},{key:"addButton",value:function(e,t,i,n,o){var a=this;if(this.uploaderCore)this.type!==this.TYPE_H5&&this.type!==this.TYPE_NATIVE||this.uploaderCore.addButton&&this.uploaderCore.addButton(e,t,i,n,o);else{var r=function(e,t,i,n,o){return function(){a.type===this.TYPE_H5&&a.uploaderCore.addButton&&a.uploaderCore.addButton(e,t,i,n,o)}}(e,t,i,n,o);this.afterInit.push(r)}}},{key:"_setReplaceType",value:function(e){if(this.uploaderCore){var t="rtype=1";if("replace"===e?t="rtype=3":"failure"===e&&(t="rtype=0"),this.uploaderCore)"function"===typeof this.uploaderCore.setUrlParams&&this.uploaderCore.setUrlParams(t);else{var i=this,n=function(e){return function(){"function"===typeof i.uploaderCore.setUrlParams&&i.uploaderCore.setUrlParams(e)}}(t);this.afterInit.push(n)}}}},{key:"_onFileLocked",value:function(e,t){this.ctx.$bus.$emit("lock-file",{file:e,isLock:t})}},{key:"_onFileError",value:function(e,t){var i,n,o={file:e};t&&t.msg&&(o.errmsg=t.msg,o.errno=t.errno);var a="0";switch(this.type){case this.TYPE_FLASH:a="1";break;case this.TYPE_NATIVE:a="2";break}var r="3",s="local",l="https:"===location.protocol?1:0;if("string"===typeof t.errorServer)switch(t.errorServer){case"pcs":r="0",s="pcs";break;case"netdisk":r="1",s="netdisk";break}else"number"===typeof t.errorServer&&(r=""+t.errorServer);o.httpStatus="undefined"!==typeof t.httpStatus?t.httpStatus:"",o.errno="undefined"!==typeof t.errno?t.errno:"",o.errorCodeInfo=o.errno+"-"+l+a+r+o.httpStatus,o.retry=e.retry,this._isUseDialog(e)&&this.ctx.$bus.$emit("error-file",o);var u=null===(i=window.globalVue)||void 0===i||null===(i=i.$store)||void 0===i||null===(i=i.state)||void 0===i?void 0:i.webmaster,c=u.webmasterIdentity,d=c?"webmaster":"normal";o.errno&&(null===(n=window)||void 0===n||null===(n=n.globalVue)||void 0===n||n.$writeLog("action","web_uploadfile_normalUpload_fail",{errno:o.errno,page:"main",fileSize:e.size,uploadType:this.type,httpProtocol:l,detail:o.errno+"-"+s+"-"+o.httpStatus,authentication:d}))}},{key:"_hasUnComplete",value:function(){return this.type===this.TYPE_NATIVE?this.uploaderCore.hasUnComplete&&this.uploaderCore.hasUnComplete():0}},{key:"_isUseDialog",value:function(e){return"boolean"!==typeof e.useDialog||e.useDialog}},{key:"_onAddFiles",value:function(e,t){var i=!1,n=this._hasUnComplete();n&&(i=!0),this._isUseDialog(e)?this.ctx.$bus.$emit("add-files",{files:[e],evtFiles:t,silent:i}):this.loadingIns=this.ctx.$Loading({text:"正在上传文件，请稍候~",background:"rgba(255,255,255,0.9)",fullscreen:!0,customClass:"nd-common-loading"}),i||this.uploaderCore.upload(void 0,!0)}},{key:"_onFileInQueue",value:function(e){this._isUseDialog(e)&&this.ctx.$bus.$emit("requeue-file",{file:e})}},{key:"_onRemoveFile",value:function(e){this.ctx.$bus.$emit("remove-file",{file:e})}},{key:"_onFileUploadStart",value:function(e){this._isUseDialog(e)&&this.ctx.$bus.$emit("start-upload-file",{file:e})}},{key:"_onFileSuccess",value:function(e,t){var i={file:e};t&&t.msg&&(i.succmsg=t.msg),this._isUseDialog(e)?this.ctx.$bus.$emit("success-file",Object(b["a"])(Object(b["a"])({},i),{},{uploadSuccessType:t.uploadType||"-"})):this.loadingIns&&this.loadingIns.close(),e.uploadedFn&&"function"===typeof e.uploadedFn&&e.uploadedFn.call(this.ctx,e),e.size>4294967296&&window.globalVue.$writeLog("action","web_upload_size_over4g_finish",{fileSize:Object(Z["f"])(e.size)})}},{key:"_onFolderStatusChange",value:function(e,t,i){this._isUseDialog(e)&&this.ctx.$bus.$emit("change-folder-status",{file:e,completeNum:t,allNum:i})}},{key:"_onProgressFile",value:function(e,t,i,n){var o=i;if(100===t)i="";else if("number"===typeof i){var a=!1;this.type===this.TYPE_NATIVE&&(a=!0,o=i/8),i=this._parseSpeed(i,a)}var r={file:e,progress:t,speed:i,originalSpeed:o/1024,folderParam:n};this._isUseDialog(e)&&this.ctx.$bus.$emit("progress-file",r)}},{key:"_onFilePause",value:function(e){this.ctx.$bus.$emit("pause-file",{file:e})}},{key:"_onFileContinue",value:function(e){this.ctx.$bus.$emit("continue-file",{file:e})}},{key:"_parseSpeed",value:function(e,t){return t&&(e/=8,e<8)?Math.round(e)+"b/s":e<1024?Math.round(e)+"B/s":e<1048576&&e>=1024?Math.round(e/1024)+"KB/s":e<1073741824&&e>=1048576?10*(e/1024/1024).toFixed(1)/10+"MB/s":100*(e/1024/1024/1024).toFixed(2)/100+"GB/s"}},{key:"_initEvents",value:function(){if(this.uploaderCore){var e=this;this.uploaderCore.onGetServerPath=function(){var t="/";if(e.uploadPath)t=e.uploadPath;else{var i=e.ctx.$route,n=i&&i.query&&i.query.path;n&&(t=n)}return t.lastIndexOf("/")<t.length-1&&(t+="/"),t},this.uploaderCore.onUpdateStatus=function(){},this.uploaderCore.onProgressPause=function(){},this.uploaderCore.onProgressResume=function(){},this.uploaderCore.onFileLocked=function(t,i){t&&e._onFileLocked(t,i)},this.uploaderCore.onChooseFile=function(e,t){},this.uploaderCore.onFileAccepted=function(t,i,n,o){t&&e._onAddFiles(t,o)},this.uploaderCore.onFileInQueue=function(t){t&&e._onFileInQueue(t)},this.uploaderCore.onFileRemoved=function(t,i){t&&e._onRemoveFile(t)},this.uploaderCore.onFileError=function(t,i,n,o,a){if(t){i!==this.ctx.$t("main.upload.notEnoughSpace")&&-10!==i||this.ctx.$callPlugin({pluginNameAtGroup:"storageDialog-plugin@com.terabox.pan"});var r=this.ctx.$t("main.errMsg.err1");"number"===typeof i||/^\-?\d+$/.test(i)?(r=e.errorMsg[i],r?t.retry=!1:r=this.ctx.$t("main.errMsg.err1")):"string"===typeof i&&(r=i),e._onFileError(t,{msg:r,errno:n,errorServer:o,httpStatus:a})}},this.uploaderCore.onFileUploadStart=function(t){t&&e._onFileUploadStart(t)},this.uploaderCore.onFileSuccess=function(t,i){t&&e._onFileSuccess(t,i)},this.uploaderCore.onFileProgress=function(t,i,n){t&&e._onProgressFile(t,i,n)},this.uploaderCore.onFilePause=function(t){t&&e._onFilePause(t)},this.uploaderCore.onFileContinue=function(t){t&&e._onFileContinue(t)},this.uploaderCore.onSessionProgressComplete=function(e){},this.uploaderCore.onQueueClear=function(){},this.uploaderCore.onFolderStatusChange=function(t,i,n){t&&e._onFolderStatusChange(t,i,n)},this.ctx.$bus.$on("operate-clear-queue",(function(){e._clearQueue()})),this.ctx.$bus.$on("operate-file-continue",(function(t){e._continueFile(t.file)})),this.ctx.$bus.$on("operate-file-retry",(function(t){e._retryFile(t.file)})),this.ctx.$bus.$on("operate-file-remove",(function(t){e._removeFile(t.file)})),this.ctx.$bus.$on("operate-file-pause",(function(t){e._pauseFile(t.file)})),this.ctx.$bus.$on("operate-file-start",(function(){e._startUpload()}))}}},{key:"_clearQueue",value:function(){this.uploaderCore.clearQueue&&this.uploaderCore.clearQueue(),this.ctx.$bus.$emit("clear-queue",{})}},{key:"_startUpload",value:function(){this.uploaderCore.upload(void 0,!0)}},{key:"_removeFile",value:function(e){this.uploaderCore.remove&&this.uploaderCore.remove(e)}},{key:"_pauseFile",value:function(e){this.uploaderCore.pause&&this.uploaderCore.pause(e)}},{key:"_continueFile",value:function(e){this.uploaderCore.goOn&&this.uploaderCore.goOn(e)}},{key:"_retryFile",value:function(e){this.uploaderCore.upload(e)}}],[{key:"getInstance",value:function(t){return e.instance||(e.instance=new e(t)),e.instance}}])}(),re=ae,se=null,le={name:"upload-plugin",mixins:[f["a"]],components:{confirmDialog:p},data:function(){return{confirmCfg:{title:"",content:"",show:!1,showCancelBtn:!1,okText:"",cancelText:"",noFooter:!0,okFn:function(){}},initStart:!0,initError:!1,uploaderIndex:-1,initDialogButtons:[]}},created:function(){var e=this;se?console.log("[Plugin][uploader] dialogUploader is done"):console.log("[Plugin][uploader] created"),this.init(),this.ctx.$bus.$on(this.ctx.busEvents.uploaderConfirmDialog,(function(t){e.confirmDialog(t)})),this.$bus.$on("fileManageDone",(function(e){})),this.ctx.$bus.$on(this.ctx.busEvents.addUploadButton,(function(t){var i=t&&t.button,n=e;se?se.addButton(i,t.mode||-110,t.useDialog,t.uploadedFn,t.fileTypes):n.uploader&&n.uploader.afterInit.push((function(){n.uploader.uploaderCore&&n.uploader.addButton(i,t.mode||-110,t.useDialog,t.uploadedFn,t.fileTypes)}))})),setTimeout((function(){e.ctx.$bus.$emit(e.ctx.busEvents.timeToAddUploadButton)}),200)},beforeDestroy:function(){this.ctx.$bus.$off(this.ctx.busEvents.addUploadButton),this.ctx.$bus.$off(this.ctx.busEvents.uploaderConfirmDialog)},methods:{cancel:function(){this.confirmCfg.cancelFn()},init:function(){if(this.otherParam&&this.otherParam.renderFn){var e=this.otherParam.renderFn;this[e]&&this[e](this.ctx,this.otherParam)}else this.start(this.ctx,this.otherParam)},start:function(e,t){t&&t.button&&(t&&t.useDialog&&se?(this.initDialogButtons.push(t.button),this.initLeftButtons()):this.onUploadButtonRender(e,t))},onUploadButtonRender:function(e,t){t&&t.button&&("string"===typeof t.button&&(t.button=document.querySelector(t.button)),t.mode=t.mode||"directory",this.initUpload(!0,t))},initUpload:function(e,t){if(this.initStart=!0,e&&se)se.addButton(t.button);else{this.uploaderIndex++;var i="undefined"!==typeof y&&y.getItem("uploadType"),n="single"===t.mode?-100:"directory"===t.mode?-90:-110;this.uploader=re.getInstance({ctx:this.ctx,button:t.button,mode:n,uType:i,fileTypes:t.fileTypes,uploadPath:t.basePath,afterInit:[function(){self.initStart=!1,se=this}],messageFor:this.uploaderIndex})}},initLeftButtons:function(){if(se){for(var e=0,t=this.initDialogButtons.length;e<t;e++)se.addButton(pri.initDialogButtons[e]);this.initDialogButtons.length=0}},confirmDialog:function(e){"boolean"===typeof e?this.confirmCfg.show=e:this.confirmCfg=e}}},ue=le,ce=(i("e9ef"),Object(c["a"])(ue,o,a,!1,null,null,null));t["default"]=ce.exports},c571:function(e,t,i){},d9c0:function(e,t,i){},e9ef:function(e,t,i){"use strict";i("c571")},fc52:function(e,t,i){"use strict";i("d9c0")}}]);